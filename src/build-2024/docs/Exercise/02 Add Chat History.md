# Exercise : Add Chat History

This console application demonstrates a basic chat interface using OpenAI's GPT model (such as GPT-3.5-Turbo or GPT-4-Turbo) through the Microsoft Semantic Kernel. The application maintains a stateful chat interface, where it continuously takes user input and provides responses generated by the AI model, while remembering previous context.

1. Open the project you have created in [01 Hello Semantic Kernel](./01%20Hello%20Semantic%20Kernel.md) in VS Code or Visual Studio.

1. Add the following using statment at the top of `Program.cs` file.

    ```csharp
    using Microsoft.SemanticKernel.ChatCompletion;
    ```

1. Add the following code next to kernel initialization to get the required service from the kernel which is chat the completion service.

    ```csharp
Change the code from 
    ```csharp
    var kernel = Kernel.CreateBuilder()
          .AddOpenAIChatCompletion(openAIChatCompletionModelName, Environment.GetEnvironmentVariable("OPENAI_API_KEY"))
          .Build();
    ```
to

    ```csharp
    var kernel = Kernel.CreateBuilder()
          .AddOpenAIChatCompletion(openAIChatCompletionModelName, Environment.GetEnvironmentVariable("OPENAI_API_KEY"))
          .Build();

    var chatService = kernel.GetRequiredService<IChatCompletionService>();
    ```
    ```

1. Add a variable to store conversation chat history to provide more context for upcoming user requests before the while loop.

    ```Csharp
    ChatHistory chatHistory = [];
    ```

1. Modify the while loop as follows get the request from the user , add to the `chatHistory`, pass the request to the service a get response from the LLM and add the response to the `chatHistory`

    ```csharp
    // Basic chat
    while (true)
    {
        Console.Write("Q: ");
        chatHistory.AddUserMessage(Console.ReadLine()); // Add user message to chat history.
        var response = await chatService.GetChatMessageContentAsync(chatHistory); // Get chat response based on chat history.
        Console.WriteLine(response); // Print response.
        chatHistory.Add(response); // Add chat response to chat history
    }
    ```

1. Let's see what we have so far, you can run the application by entering `dotnet run` into the terminal. Experiment with a user prompt "Hi my name is Alice" and a follow-up question "What is my name?" You will see an output similar as shown below on console.

    ```console
    Q: Hi my name is Alice
    Hello Alice! Nice to meet you. How can I assist you today?
    Q: What is my name?
    Your name is Alice.
    Q:
    ```

## Complete sample project

View the completed sample in the  [02 - Add Chat History](../../02%20-%20Add%20Chat%20History/) project.

## Note

By maintaining a chat history, the application ensures that the AI model can remember previous contexts and provide more coherent and contextually relevant responses.

 ### Next unit: Exercise - Add Plugin - Function Call
[Continue](./03%20Add%20Plugin%20(Function%20Call).md)