# Exercise : Add Chat History

This console application demonstrates a basic chat interface using OpenAI's GPT model (such as GPT-3.5-Turbo or GPT-4-Turbo) through the Microsoft Semantic Kernel. The application maintains a stateful chat interface, where it continuously takes user input and provides responses generated by the AI model, while remembering previous contexts.

## Prerequisites

 You can refer [here](https://github.com/zewditu/ai-samples/blob/U/zewd/Build2024/src/build-2024/01%20-%20Hello%20Semantic%20Kernel/README.md#prerequisites)

## Overview

1. Import usings

 ```csharp
 using Microsoft.SemanticKernel;
using Microsoft.SemanticKernel.ChatCompletion;
```

2. Build the kernel with the selected chat completion model and OpenAI API key, and add the service we want to use, in this case, AddOpenAIChatCompletion.

```csharp
string openAIChatCompletionModelName = "gpt-3.5-turbo"; // this could be other models like "gpt-4o".
var kernel = Kernel.CreateBuilder()
    .AddOpenAIChatCompletion(openAIChatCompletionModelName, Environment.GetEnvironmentVariable("OPENAI_API_KEY")) // add the OpenAI chat completion service.
    .Build();
```

3. Get the required service, which is the chat completion service for this scenario, using kernel.GetRequiredService<IChatCompletionService>() from the kernel. Define a variable of type ChatHistory to store all chat responses from previous conversations to provide more context for the next inquiry.

```Csharp
var chatService = kernel.GetRequiredService<IChatCompletionService>();
ChatHistory chatHistory = [];
```

4. Chat with LLM: For every user request in a while loop, send the request to chatService and get the response. Print the response back to the user and add both the user's request and the LLM's response to the chat history to provide more context for the next user request.

```csharp
// Basic chat
while (true)
{
    Console.Write("Q: ");
    chatHistory.AddUserMessage(Console.ReadLine()); // Add user message to chat history.
    var response = await chatService.GetChatMessageContentAsync(chatHistory); // Get chat response based on chat history.
    Console.WriteLine(response); // Print response.
    chatHistory.Add(response); // Add chat response to chat history
}
```

## Note

By maintaining a chat history, the application ensures that the AI model can remember previous contexts and provide more coherent and contextually relevant responses.

 ### Next unit: Exercise - Add Plugin - Function Call
[Continue](./03%20Add%20Plugin%20(Function%20Call).md)